apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: argocd-application-controller-extended
  labels:
    app.kubernetes.io/name: argocd
    app.kubernetes.io/component: application-controller
rules:
  # Grant read access to ALL resources for cluster discovery
  # This allows ArgoCD to discover what's in the cluster without errors
  - apiGroups:
      - "*"
    resources:
      - "*"
    verbs:
      - get
      - list
      - watch

  # Grant write access to common resources ArgoCD needs to manage
  - apiGroups:
      - ""
    resources:
      - pods
      - services
      - endpoints
      - persistentvolumeclaims
      - events
      - configmaps
      - secrets
      - serviceaccounts
      - namespaces
    verbs:
      - create
      - update
      - patch
      - delete

  - apiGroups:
      - "apps"
    resources:
      - deployments
      - daemonsets
      - replicasets
      - statefulsets
    verbs:
      - create
      - update
      - patch
      - delete

  - apiGroups:
      - "batch"
    resources:
      - jobs
      - cronjobs
    verbs:
      - create
      - update
      - patch
      - delete

  - apiGroups:
      - "networking.k8s.io"
    resources:
      - ingresses
      - networkpolicies
    verbs:
      - create
      - update
      - patch
      - delete

  - apiGroups:
      - "rbac.authorization.k8s.io"
    resources:
      - roles
      - rolebindings
    verbs:
      - create
      - update
      - patch
      - delete

  - apiGroups:
      - "autoscaling"
    resources:
      - horizontalpodautoscalers
    verbs:
      - create
      - update
      - patch
      - delete

  # Traefik CRDs (for managing ingress routes)
  - apiGroups:
      - "traefik.containo.us"
      - "traefik.io"
    resources:
      - "*"
    verbs:
      - create
      - update
      - patch
      - delete

  # Cert-manager (for managing certificates)
  - apiGroups:
      - "cert-manager.io"
      - "acme.cert-manager.io"
    resources:
      - "*"
    verbs:
      - create
      - update
      - patch
      - delete
